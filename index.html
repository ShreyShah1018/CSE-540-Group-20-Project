<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Card Provenance Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <div class="container">
        <h1>ğŸ´ Pokemon Card Provenance Tracker</h1>
        <p class="subtitle">Blockchain-based ownership & grading system</p>

        <div id="connection-status">Not Connected</div>

        <!-- Navbar (A2 + A3) -->
        <nav class="navbar">
            <!-- Chg A2 -->
            <button class="nav-link active" data-page="home" onclick="navigate('home')">Home</button>
            <!-- Chg A2 -->
            <button class="nav-link" data-page="market" onclick="navigate('market')">Market</button>
            <!-- Chg A2 -->
            <button class="nav-link" data-page="config" onclick="navigate('config')">Configuration</button>
            <!-- Create Card page button, owner only (shown via JS) -->
            <button class="nav-link" data-page="create" id="navCreate" onclick="navigate('create')"
                style="display:none;">Create Card</button>
            <!-- Chg A3 -->
        </nav>

        <!-- Home Page: Account Selection + Grading Queue -->
        <div id="page-home" class="page">
            <!-- Chg A2 -->

            <!-- Account Selection -->
            <div class="section">
                <h2>ğŸ‘¤ Account Selection</h2>
                <select id="accountSelect" onchange="switchAccount()">
                    <option value="">Select Account...</option>
                </select>
                <p style="margin-top: 10px; color: #666;">
                    Current Account: <strong id="currentAccount">Not connected</strong><br>
                    Balance: <strong id="accountBalance">0 ETH</strong>
                </p>
            </div>
            <button onclick="loadQueue()">ğŸ”„ Refresh Queue</button>
            <button id="gradeNextBtn" onclick="processNextInQueue()" class="secondary" style="display:none;">
                Grade Next Card
            </button>

            <!-- Grading Queue -->
            <div class="section">
                <h2>ğŸ“‹ Grading Queue</h2>

                <!-- <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong>âš ï¸ Before Processing Queue:</strong>
                    <p style="margin: 10px 0;">You need to authorize a grader account first. Use Account 0 (contract
                        owner)
                        to authorize another account as grader.</p>
                    <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px;">
                        <input type="text" id="graderAccountAddress" placeholder="Grader address (e.g., 0x123...)"
                            style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <button onclick="authorizeGrader()">âœ… Authorize Grader</button>
                    </div>
                </div> -->

                <div id="queueInfo" class="queue-info">
                    <div class="loading">Loading queue information...</div>
                </div>

                <!-- Vertical list of queued cards - Chg A10 -->
                <div id="queueList" class="queue-list"></div> <!-- Chg A10 -->

                
                <!-- Chg A3 -->
            </div>
        </div>

        <!-- Market Page: All Cards -->
        <div id="page-market" class="page" style="display:none;">
            <!-- Chg A2 -->
            <div class="section">
                <h2>ğŸ´ All Cards</h2>
                <button onclick="loadCards()">ğŸ”„ Refresh Cards</button>
                <div id="cards" class="cards-grid">
                    <div class="loading">Connect contracts to load cards...</div>
                </div>
            </div>
        </div>

        <!-- Configuration Page: Contract Config -->
        <div id="page-config" class="page" style="display:none;">
            <!-- Chg A2 -->
            <div class="config-section">
                <h3>ğŸ“ Contract Configuration</h3>
                <p style="color: #666; margin-bottom: 15px;">
                    After deploying contracts in Remix, paste the addresses and ABIs below:
                </p>

                <div class="input-group">
                    <label>CardRegistry Address:</label>
                    <input type="text" id="cardRegistryAddress" placeholder="0x...">
                </div>

                <div class="input-group">
                    <label>Marketplace Address:</label>
                    <input type="text" id="marketplaceAddress" placeholder="0x...">
                </div>

                <div class="input-group">
                    <label>GraderContract Address:</label>
                    <input type="text" id="graderAddress" placeholder="0x...">
                </div>

                <div class="input-group">
                    <label>CardRegistry ABI (paste from Remix):</label>
                    <textarea id="cardRegistryABI" placeholder='[{"inputs":...}]'></textarea>
                </div>

                <div class="input-group">
                    <label>Marketplace ABI:</label>
                    <textarea id="marketplaceABI" placeholder='[{"inputs":...}]'></textarea>
                </div>

                <div class="input-group">
                    <label>GraderContract ABI:</label>
                    <textarea id="graderABI" placeholder='[{"inputs":...}]'></textarea>
                </div>

                <button onclick="initializeContracts()">ğŸ”— Connect to Contracts</button>
                <button onclick="saveConfig()" class="secondary">ğŸ’¾ Save Config</button>
                <button onclick="loadConfig()" class="success">ğŸ“‚ Load Config</button>
            </div>
        </div>

        <!-- Create Card Page (owner only) -->
        <div id="page-create" class="page" style="display:none;">
            <!-- Chg A3 -->
            <!-- Create Card -->
            <div class="section" id="createCardSection">
                <!-- Chg A1 (existing owner-only section, now moved to its own page) -->
                <h2>ğŸ¨ Create New Card (Company Only)</h2>
                <div class="input-group">
                    <label>Card Name:</label>
                    <input type="text" id="cardName" placeholder="e.g., Charizard Base Set #4">
                </div>
                <div class="input-group">
                    <label>Card Image (upload to IPFS):</label> <!-- Chg A5 -->
                    <input type="file" id="cardImageFile" accept="image/*"> <!-- Chg A5 -->
                </div>
                <!-- <div class="input-group">
                    <label>Metadata CID (IPFS):</label>
                    <input type="text" id="metadataCID" placeholder="QmXXX...">
                </div> -->
                <div class="input-group">
                    <label>Price (ETH):</label>
                    <input type="number" id="price" placeholder="1.5" step="0.01">
                </div>
                <button onclick="createCard()">âœ¨ Create Card</button>
            </div>
        </div>
    </div>

    <!-- Modal for History and Details -->
    <div id="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>
    <script src="index.js"></script>
    </script>
</body>

</html>
